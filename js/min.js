var app=angular.module("App","ui.router ngAnimate ui.bootstrap ngTouch angulartics angulartics.google.analytics angulartics.piwik duScroll autocomplete ngMap rzModule ngFileUpload".split(" ")),searchkey;app.config(["$httpProvider","$stateProvider","$urlRouterProvider","$locationProvider","$urlMatcherFactoryProvider","$compileProvider",function(b,c,e,h,d,f){h.html5Mode(!0);h.hashPrefix("!");d.strictMode(!1);e.deferIntercept();$urlRouterProviderRef=e;$stateProviderRef=c;f.aHrefSanitizationWhitelist(/^\s*(|https|http|blob|ftp|mailto|tel):/);b.interceptors.push(["$rootScope","$location",function(b,c){return{responseError:function(e){401===e.status&&(alert(b.l.lng_session_gone),c.path("/"),location.reload())}}}])}]);app.run(["$rootScope","$state","$urlRouter","$uibModalStack","$q","API","$location","$document","$timeout","ResponsiveDetection","$uibModal","$anchorScroll",function(b,c,e,h,d,f,g,k,l,n,p,m){b.filterLang=function(b){b=b.toLowerCase();b=b.replace(/\u00e4/g,"ae");b=b.replace(/\u00f6/g,"oe");b=b.replace(/\u00fc/g,"ue");b=b.replace(/\u00df/g,"ss");b=b.replace(/\u0430/g,"a");b=b.replace(/\u0431/g,"b");b=b.replace(/\u0432/g,"v");b=b.replace(/\u0433/g,"g");b=b.replace(/\u0434/g,"d");b=b.replace(/\u0435/g,"e");b=b.replace(/\u0451/g,"yo");b=b.replace(/\u0436/g,"zh");b=b.replace(/\u0437/g,"z");b=b.replace(/\u0438/g,"i");b=b.replace(/\u0439/g,"j");b=b.replace(/\u043a/g,"k");b=b.replace(/\u043b/g,"l");b=b.replace(/\u043c/g,"m");b=b.replace(/\u043d/g,"n");b=b.replace(/\u043e/g,"o");b=b.replace(/\u043f/g,"p");b=b.replace(/\u0440/g,"r");b=b.replace(/\u0441/g,"s");b=b.replace(/\u0442/g,"t");b=b.replace(/\u0443/g,"u");b=b.replace(/\u0444/g,"f");b=b.replace(/\u0445/g,"h");b=b.replace(/\u0446/g,"c");b=b.replace(/\u0447/g,"ch");b=b.replace(/\u0448/g,"sh");b=b.replace(/\u0449/g,"ssh");b=b.replace(/\u044a/g,"");b=b.replace(/\u044b/g,"y");b=b.replace(/\u044c/g,"");b=b.replace(/\u044d/g,"je");b=b.replace(/\u044e/g,"ju");b=b.replace(/\u044f/g,"ja");b=b.replace(/\W/g,"");return b=b.replace(/\_/g,"+")};b.status=d.defer();b.AnzahlMobilIcon=0;f.get("session/status").then(function(d){b.status.resolve(d);b.l=d.l;b.settings=d.settings;b.row=d.aktionsvariablen;b.tmg=d.tmg;b.url=d.url;b.mainTemplate="template/"+d.templates.main;b.merkzettelhead=b.warenkorbhead=b.angebothead=b.kontohead=b.lagerbuchunghead="template/"+d.templates.kopf;b.template={modalGalerie:d.templates.dialog_galerie,modalPW:d.templates.dialog_pw,modalLogin:d.templates.dialog_login,modalBild:d.templates.dialog_bild,modalMerkzettel:d.templates.dialog_merkzettel,modalWarenkorb:d.templates.dialog_warenkorb};b.merkzettelcontent="template/"+d.templates.merkzettel;b.warenkorbcontent=b.angebotcontent=b.lagerbuchungcontent="template/"+d.templates.warenkorb;b.kontocontent="template/"+d.templates.konto;b.merkzettelfoot=b.warenkorbfoot=b.angebotfoot=b.kontofoot=b.lagerbuchungfoot="template/"+d.templates.fuss;$stateProviderRef.state("forget",{url:"/forget?token",templateUrl:"template/includes/forget.html",controller:["$rootScope","$scope","$location","$timeout","$stateParams","API",function(b,c,d,e,f,g){f.token||d.path("/");c.changePasswort=function(b){c.msg=null;g.post("konto/changePasswort",{token:f.token,passwort:b}).then(function(b){c.msg=!0;e(function(){d.path("/")},5E3)},function(){c.error=!0})}}]}).state("confirm",{url:"/confirm?id?token",template:'<div class="container" style="padding-top: 100px"><center><img src="template/images/head_logo.png"></center><div style="margin-top: 20px" class="alert alert-success" ng-class="{\'alert-danger\' : response.type==\'ERROR\'}"><strong>{{response.msg}}</strong> <a class="close" href=".">weiter zur Seite</a></div></div>',controller:["$rootScope","$scope","$location","$timeout","$stateParams","API",function(b,c,d,e,f,g){b.titel="confirm";f.id&&f.token?g.get("konto/confirm",{id:f.id,token:f.token}).then(function(b){c.response=b;e(function(){d.path("/")},5E3)}):c.response={type:"ERROR",msg:"Keine Parameter angegeben!"}}]}).state("search",{url:"/search/:suchwort?key&page&sortBy&limitTo&facet_gruppen_pfade&facet_price_range",reloadOnSearch:!1,titel:"Search",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@search":{templateUrl:"template/"+d.templates.kopf},"content@search":{templateUrl:"template/"+d.templates.suche,controller:"SuchCtrl"},"foot@search":{templateUrl:"template/"+d.templates.fuss}}}).state("registrierung",{url:"/registrierung?typ?zumWK",titel:"Registrierung",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@registrierung":{templateUrl:"template/"+d.templates.kopf},"content@registrierung":{templateUrl:"template/"+d.templates.registrierung,controller:"KontoCtrl"},"foot@registrierung":{templateUrl:"template/"+d.templates.fuss}}}).state("bestellvorschlag",{url:"/bestellvorschlag",titel:"Bestellvorschlag",action:{type:"artikel"},views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@bestellvorschlag":{templateUrl:"template/"+d.templates.kopf},"content@bestellvorschlag":{templateUrl:"template/"+d.templates.bestellvorschlag,controller:"BestellvorschlagCtrl"},"foot@bestellvorschlag":{templateUrl:"template/"+d.templates.fuss}}}).state("impressum",{url:"/impressum",titel:b.l.lng_menu_left_impressum,apiurl:"tmgangaben/inhalte/1",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@impressum":{templateUrl:"template/"+d.templates.kopf},"content@impressum":{templateUrl:"template/"+d.templates.tmg},"foot@impressum":{templateUrl:"template/"+d.templates.fuss}}}).state("agb",{url:"/agb",titel:b.l.lng_menu_left_agb,apiurl:"tmgangaben/inhalte/2",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@agb":{templateUrl:"template/"+d.templates.kopf},"content@agb":{templateUrl:"template/"+d.templates.tmg},"foot@agb":{templateUrl:"template/"+d.templates.fuss}}}).state("lieferbedingungen",{url:"/lieferbedingungen",titel:b.l.lng_menu_left_lieferbed,apiurl:"tmgangaben/inhalte/3",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@lieferbedingungen":{templateUrl:"template/"+d.templates.kopf},"content@lieferbedingungen":{templateUrl:"template/"+d.templates.tmg},"foot@lieferbedingungen":{templateUrl:"template/"+d.templates.fuss}}}).state("zahlungsbedingungen",{url:"/zahlungsbedingungen",titel:b.l.lng_menu_left_zahlungsbed,apiurl:"tmgangaben/inhalte/4",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@zahlungsbedingungen":{templateUrl:"template/"+d.templates.kopf},"content@zahlungsbedingungen":{templateUrl:"template/"+d.templates.tmg},"foot@zahlungsbedingungen":{templateUrl:"template/"+d.templates.fuss}}}).state("widerrufsbelehrung",{url:"/widerrufsbelehrung",titel:b.l.lng_menu_left_widerrufsbel,apiurl:"tmgangaben/inhalte/5",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@widerrufsbelehrung":{templateUrl:"template/"+d.templates.kopf},"content@widerrufsbelehrung":{templateUrl:"template/"+d.templates.tmg},"foot@widerrufsbelehrung":{templateUrl:"template/"+d.templates.fuss}}}).state("datenschutzerklaerung",{url:"/datenschutzerklaerung",titel:b.l.lng_menu_left_datenschutzerk,apiurl:"tmgangaben/inhalte/6",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@datenschutzerklaerung":{templateUrl:"template/"+d.templates.kopf},"content@datenschutzerklaerung":{templateUrl:"template/"+d.templates.tmg},"foot@datenschutzerklaerung":{templateUrl:"template/"+d.templates.fuss}}}).state("article",{url:"/article/:id?artnr",titel:"Artikeldetail",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@article":{templateUrl:"template/"+d.templates.kopf},"content@article":{templateUrl:"template/"+d.templates.artikel_detail,controller:"ArtikeldetailCtrl"},"foot@article":{templateUrl:"template/"+d.templates.fuss}}}).state("katalog",{url:"/link/katalog/:id",titel:"Katalog",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@katalog":{templateUrl:"template/"+d.templates.kopf},"content@katalog":{templateUrl:"template/"+d.templates.katalog_detail,controller:"DetailCtrl"},"foot@katalog":{templateUrl:"template/"+d.templates.fuss}}}).state("news",{url:"/link/news/:id",titel:"News",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@news":{templateUrl:"template/"+d.templates.kopf},"content@news":{templateUrl:"template/"+d.templates.news_detail,controller:"DetailCtrl"},"foot@news":{templateUrl:"template/"+d.templates.fuss}}}).state("termin",{url:"/link/termin/:id",titel:"Termin",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@termin":{templateUrl:"template/"+d.templates.kopf},"content@termin":{templateUrl:"template/"+d.templates.termin_detail,controller:"DetailCtrl"},"foot@termin":{templateUrl:"template/"+d.templates.fuss}}}).state("galerie",{url:"/link/galerie/:id",titel:"Galerie",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@galerie":{templateUrl:"template/"+d.templates.kopf},"content@galerie":{templateUrl:"template/"+d.templates.galerie,controller:"DetailCtrl"},"foot@galerie":{templateUrl:"template/"+d.templates.fuss}}}).state("kontakt",{url:"/kontakt",titel:b.l.lng_menu_left_kontakt,views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@kontakt":{templateUrl:"template/"+d.templates.kopf},"content@kontakt":{templateUrl:"template/"+d.templates.formular,controller:"DetailCtrl"},"foot@kontakt":{templateUrl:"template/"+d.templates.fuss}}}).state("konto",{url:"/konto?bereich&p1&seite&suche&status&belegtyp&sortby&sorton",titel:"Mein Konto",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@konto":{template:"<div ng-include='kontohead'></div>"},"content@konto":{template:"<div ng-include='kontocontent'></div>",controller:"KontoCtrl"},"foot@konto":{template:"<div ng-include='kontofoot'></div>"}}}).state("merkzettel",{url:"/merkzettel",titel:"Merkzettel",views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@merkzettel":{template:"<div ng-include='merkzettelhead'></div>"},"content@merkzettel":{template:"<div ng-include='merkzettelcontent'></div>",controller:"MerkzettelCtrl"},"foot@merkzettel":{template:"<div ng-include='merkzettelfoot'></div>"}}}).state("warenkorb",{url:"/warenkorb?p1",titel:b.l.lng_menu_warenkorb,views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@warenkorb":{template:"<div ng-include='warenkorbhead'></div>"},"content@warenkorb":{template:"<div ng-include='warenkorbcontent'></div>",controller:"WarenkorbCtrl"},"foot@warenkorb":{template:"<div ng-include='warenkorbfoot'></div>"}}}).state("angebot",{url:"/angebot?p1",titel:b.l.lng_menu_angebot,views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@angebot":{template:"<div ng-include='angebothead'></div>"},"content@angebot":{template:"<div ng-include='angebotcontent'></div>",controller:"WarenkorbCtrl"},"foot@angebot":{template:"<div ng-include='angebotfoot'></div>"}}}).state("lagerbuchung",{url:"/lagerbuchung",titel:b.l.lng_menu_lagerbuchung,views:{"":{template:"<div ng-include='mainTemplate'></div>"},"head@lagerbuchung":{template:"<div ng-include='lagerbuchunghead'></div>"},"content@lagerbuchung":{template:"<div ng-include='lagerbuchungcontent'></div>",controller:"WarenkorbCtrl"},"foot@lagerbuchung":{template:"<div ng-include='lagerbuchungfoot'></div>"}}});angular.forEach(d.menu.items,function(c){1==c.values.mobil&&c.values.icon&&b.AnzahlMobilIcon++;c.values.action.type&&"portal"!=c.values.action.type&&"artikel"!=c.values.action.type&&(b[c.values.action.type+"head"]="template/"+c.values.template.head,b[c.values.action.type+"content"]="template/"+c.values.template.list,b[c.values.action.type+"foot"]="template/"+c.values.template.foot)});b.menu=d.menu.items;b.kunde=d.kunde;0==b.kunde.eingeloggt&&d.nutzer&&(b.kunde.username=d.nutzer.name,b.kunde.eingeloggt=!0);b.lang=d.lang;for(var g=0;g<b.lang.length;g++)b.lang[g].activ||b.lang.splice(g,1);var h=null,m=null,p=function(d,e,f,g){if("link"!=d.values.action.type){f||(m=d.nodes);e=e?e+"/":"";var l=d.values.titel.replace(/\s/g,"_"),l=b.filterLang(l);e+=l;d.state="3xcms_"+e;if("konto"==d.values.action.type||"warenkorb"==d.values.action.type||"angebot"==d.values.action.type||"merkzettel"==d.values.action.type||"bestellvorschlag"==d.values.action.type||"registrierung"==d.values.action.type){d.state=d.values.action.type;var k={titel:d.values.titel,url:"/"+d.values.action.type,action:d.values.action,views:{}}}else k="formular"==d.values.action.type?{titel:d.values.titel,url:"/"+e+"/:id",action:d.values.action,views:{}}:{titel:d.values.titel,url:"/"+e+"?suchwort&page&sortBy&limitTo&darstellung&filter&p1&p2&p3&p4&p5&p6&p7&p8&p9&p10",action:d.values.action,views:{}};d.start?h=e:h||(h=e);d.values.template||(d.values.template=g);d.nodes&&(k.nodes=d.nodes);f&&(k.prev=f.prev?angular.copy(f.prev):[],k.prev.push({titel:f.titel,state:f.name,action:f.action}));k.views[""]={templateUrl:b.mainTemplate};k.views["head@"+d.state]={templateUrl:"template/"+d.values.template.head};g=d.values.template.list;"artikel"==d.values.action.type&&d.nodes&&(d.values.action.baum||f&&f.action.baum)?g=d.values.template.group:g||(g=d.values.template.detail);k.views["content@"+d.state]="artikel"==d.values.action.type?g==d.values.template.group?{templateUrl:"template/"+g,controller:"ArtikelgruppenCtrl"}:{templateUrl:"template/"+g,controller:"ArtikellistenCtrl"}:{templateUrl:"template/"+g,controller:"ContentCtrl"};k.views["foot@"+d.state]={templateUrl:"template/"+d.values.template.foot};c.get(d.state)||$stateProviderRef.state(d.state,k);(d.values.action.bereich||"artikel"==d.values.action.type)&&d.values.template.detail?(f=d.state+".detail",g={url:"/detail/:id?artnr",bereich:d.values.action.bereich,type:d.values.action.type,titel:d.values.titel,nodes:m,open:!1,prev:k.prev,views:{}},d.nodes&&(g.nodes=d.nodes),g.views[""]={templateUrl:b.mainTemplate},g.views["head@"+d.state]={templateUrl:"template/"+d.values.template.head},g.views["content@"+d.state]="artikel"==d.values.action.type?{templateUrl:"template/"+d.values.template.detail,controller:"ArtikeldetailCtrl"}:{templateUrl:"template/"+d.values.template.detail,controller:"DetailCtrl"},g.views["foot@"+d.state]={templateUrl:"template/"+d.values.template.foot},c.get(f)||$stateProviderRef.state(f,g)):"portal"==d.values.action.type&&d.values.action.template&&d.values.action.template.forEach(function(c){var e=d.state+".detail"+c.id,f={url:"/"+c.id+"/detail/:id",bereich:c.bereich,titel:c.titel,nodes:m,open:!1,views:{}};f.views[""]={templateUrl:b.mainTemplate};f.views["content@"+d.state]={templateUrl:"template/"+c.template.detail,controller:d.nodes?"ContentCtrl":"DetailCtrl"};$stateProviderRef.state(e,f)});d.nodes&&d.nodes.forEach(function(b){p(b,e,k,d.values.template)})}};d.menu.items.forEach(function(b){p(b)});h&&$urlRouterProviderRef.otherwise(h);e.sync();e.listen();d={breakpoint:n.getBreakpoint()};f.post("warenkorb/set",d)});b.$on("$stateChangeStart",function(c,d,e,f,m){b.og={images:["template/images/head_logo.png"]};"konto"==d.name||"merkzettel"==d.name?b.kunde.eingeloggt||g.path("/home"):"lagerbuchung"==d.name?b.kunde.eingeloggt&&"False"!=b.kunde.Rechte.RechtLB||g.path("/home"):"bestellvorschlag"==d.name?b.kunde.eingeloggt&&"False"!=b.kunde.Rechte.BestellvorschlagSehen||g.path("/home"):"registrierung"==d.name&&b.kunde.eingeloggt&&(e.zumWK?g.path("/warenkorb"):g.path("/"));(e=h.getTop())?(c.preventDefault(),h.dismiss(e.key)):b.titel=d.titel});b.$on("$stateChangeSuccess",function(c,d,e,f,h){var m=g.hash();window.scrollTo(0,0);m&&"anchorscroll"!=m?(g.url(g.path()),l(function(){var b=document.getElementById(m);if(b){var c=document.getElementById("headarea"),c=c?c.offsetHeight:0;k.scrollToElementAnimated(angular.element(b),c)}},500)):b.status.promise.then(function(c){c.aktionsvariablen.vor_login&&!c.kunde.eingeloggt&&"registrierung"!=d.name&&"forget"!=d.name&&"confirm"!=d.name?p.open({animation:!1,size:"md",templateUrl:"template/"+b.template.modalLogin,controller:"LoginCtrl",backdrop:"static",keyboard:!1}):(c=document.getElementById("anchorscroll"))&&k.scrollToElementAnimated(angular.element(c))})})}]);app.controller("MainCtrl",["$scope","$sce","$uibModal","$state","API","$uibModalStack","$timeout","$rootScope","$location","$anchorScroll",function(b,c,e,h,d,f,g,k,l,n){b.file="api/datei/";b.dynalink=!1;b.trust=function(b,d){d&&(b=(b+"").replace(/(\r\n|\n\r|\r|\n)/g,"<br>"));return c.trustAsHtml(b)};"dynalink"==searchkey&&(b.dynalink=!0);b.navbar={};b.navbar.collapsed=!0;k.WK={data:{}};k.status.promise.then(function(c){k.WK.data=c.WK;b.sprachen=c.lang;b.setSprache=function(b){d.post("spracheinstellung/lang/set",{sprache:b}).then(function(){location.reload()})}});b.closeModal=function(){var b=f.getTop();b&&f.dismiss(b.key)};b.subscribeNewsletter=function(b){b?d.post("newsletter/subscribe",{email:b}).then(function(b){k.newsletterSubscribed=b},function(b){k.newsletterSubscribed=b}):k.newsletterSubscribed="Keine E-Mail angegeben!"};b.$watch(function(){return{width:document.getElementById("content")?document.getElementById("content").offsetWidth:0,height:document.getElementById("content")?document.getElementById("content").offsetHeight:0}},function(c,d){b.contentwidth=c.width;b.contentheight=c.height},!0);b.back=function(){window.history.back()};b.top=function(){window.scrollTo(0,0)};b.openBild=function(b,c,d){e.open({animation:!1,templateUrl:"template/"+k.template.modalBild,windowClass:"app-modal-window",controller:["$scope","$uibModalInstance",function(d,e){d.img=b;d.imgnotation=c;d.close=function(){e.close()}}]})};b.openLoginModal=function(c,d){b.navbar.collapsed=!0;e.open({animation:!1,size:d?d:"sm",templateUrl:c?"template/"+c:"template/"+k.template.modalLogin,controller:"LoginCtrl"})};b.getPreisliste=function(){e.open({animation:!1,size:"sm",scope:b,templateUrl:"template/modal/preisliste/default.html",controller:"PreislistenCtrl"})};k.$on("$stateChangeSuccess",function(c,d,e,f,g){b.navbar.collapsed=!0})}]);app.controller("SuchCtrl",["$scope","API","$stateParams","$state","$timeout","Warenkorb","$rootScope",function(b,c,e,h,d,f,g){var k=searchkey?searchkey:"all";g.dynalink_data={};b.state&&(b.state.preisliste=!0);b.list={};b.list.page=e.page?parseInt(e.page):1;b.list.filter=e.filter?e.filter:"";b.list.sortBy=e.sortBy?g.settings.sortBy=e.sortBy:g.settings.sortBy?g.settings.sortBy:g.settings.sortBy="Artikelnummer";b.list.sortOn=e.sortOn?g.settings.sortOn=e.sortOn:g.settings.sortOn?g.settings.sortOn:g.settings.sortOn="ASC";b.list.limitTo=e.limitTo?g.settings.limitTo=parseInt(e.limitTo):g.settings.limitTo?parseInt(g.settings.limitTo):1<limitTo?g.settings.limitTo=parseInt(limitTo):g.settings.maxanzahl_listenansicht?g.settings.limitTo=parseInt(g.settings.maxanzahl_listenansicht):10;b.list.darstellung=e.darstellung?g.settings.darstellung=e.darstellung:g.settings.darstellung?g.settings.darstellung:g.settings.darstellung=darstellung;b.list.suchwort=e.suchwort?e.suchwort:"";b.list.key=e.key?e.key:k;b.list.facet_price_range=e.facet_price_range?e.facet_price_range:"";b.list.facet_gruppen_pfade=e.facet_gruppen_pfade?e.facet_gruppen_pfade:"";"dynalink"==searchkey&&c.get("article/facets").then(function(c){b.facets_groups=c});var l;b.$watchCollection("search",function(c,e){if(c.suche!=e.suche||c.schnellsuche!=e.schnellsuche)l&&d.cancel(l),l=d(function(){b.list.suchwort=c.suche!=e.suche?c.suche:c.schnellsuche;b.list.page=1},500);if(""==c.suche||3>c.suche.length||""==c.schnellsuche||3>c.schnellsuche.length)g.dynalink_data={}});b.$watchCollection("list",function(d){b.data=null;h.go("search",d,{notify:!1});0<d.suchwort.length?c.get("search",d).then(function(c){"dynalink"==searchkey?(b.data=c,b.data.pageCount=parseInt((c.total_count-1)/10,10)+1,b.data.aggregations=n(c.aggregations),g.dynalink_data.suggestions=c.suggestions):(b.data=c,b.data.Values=b.data.Shop.Values);b.data.Shop&&0<b.data.Shop.Anzahl&&g.row.artikelspezifische_mengeneinheiten_umrechnen&&angular.forEach(b.data.Shop.Values,function(c){c.Mengenumrechnung&&(c.MengUm={open:!1},b.changeMengeneinheit(c.Mengenumrechnung[0],c))})}):b.data={}});b.changeMengeneinheit=function(b,c){c.MengUm.select=b;b.Preis.Brutto&&(c.Artikelpreis.Brutto=b.Basis_Faktor*b.Preis.Brutto);b.Preis.Netto&&(c.Artikelpreis.Netto=b.Basis_Faktor*b.Preis.Netto);b.Preis.Listenpreis&&(b.Preis.Listenpreis.Brutto&&(c.Artikelpreis.Listenpreis.Brutto=b.Basis_Faktor*b.Preis.Listenpreis.Brutto),b.Preis.Listenpreis.Netto&&(c.Artikelpreis.Listenpreis.Netto=b.Basis_Faktor*b.Preis.Listenpreis.Netto));c.MengUm.open=!1};var n=function(b){var c=b.filtered_gruppen.gruppen,d,e;var f={};if(c.buckets){var g=c.buckets;var h=0;for(d=g.length;h<d;h++){c=g[h];var m=f;var l="";var k=c.key.split("/").slice(1);var n=0;for(e=k.length;n<e;n++){var q=k[n];l+="/"+q;m[q]||(m[q]={name:q,path:l,articleCount:0,subGroups:{}});m[q].articleCount+=c.doc_count;m=m[q].subGroups}}}f={groups:p(f)};b=b.filtered_prices.prices;k=b.buckets;l=0;for(q=k.length;l<q;l++)c=k[l],c.desc=""+(c.from||"")+"-"+(c.to||"");return{gruppen:f,prices:{ranges:b.buckets}}},p=function(b){return _.isEmpty(b)?null:_(b).map(function(b){b.subGroups=p(b.subGroups);return b}).sortBy("articleCount").reverse().value()};b.pushToWarenkorb=function(b){f.addArtikel(b,"b").then(function(b){g.WK.data=b})}}]);app.controller("TmgCtrl",["$scope","$state","API",function(b,c,e){e.get(c.current.apiurl).then(function(c){b.data=c})}]);app.controller("HeadCtrl",["$scope","$rootScope","$state","API",function(b,c,e,h){b.state=e}]);app.controller("MenuCtrl",["$scope","$rootScope","$timeout","$state","$stateParams","API","Warenkorb","$window","$location","ResponsiveDetection",function(b,c,e,h,d,f,g,k,l,n){b.state={};b.search={};var p=n.getBreakpoint();b.showSearchInput=0<c.AnzahlMobilIcon?!1:!0;b.SideMenuTitle=h.current.titel;b.state=angular.copy(h.current);var m,r=searchkey?searchkey:"all";h.current.action&&h.current.action.type&&"artikel"==h.current.action.type&&(r=searchkey?searchkey:"shop",b.row.vt_suche_alle_artikel||h.current.nodes||(r=h.current.action.value));var t=function(b,c){for(a=0;a<b.length;a++)b[a].open=!1;for(a=0;a<b.length;a++)if(h.current.prev[c+1]&&h.current.prev[c+1].state==b[a].state||h.current.name==b[a].state){b[a].open=!0;b[a].nodes&&(b[a].nodes=t(b[a].nodes,c+1));break}return b};h.current.prev&&angular.forEach(c.menu,function(c){c.state==h.current.prev[0].state&&(b.state.nodes=t(c.nodes,0))});b.unode={};b.setNode=function(c){b.unode=c};b.search.suche=b.search.schnellsuche=d.suchwort?d.suchwort:"";"search"!=h.current.name&&b.$watchCollection("search",function(b,c){b.schnellsuche!=c.schnellsuche&&(m&&e.cancel(m),m=e(function(){"xs"!=p&&"sm"!=p||document.activeElement.blur();h.go("search",{suchwort:b.schnellsuche,key:r})},1E3))});b.suchen=function(b){b&&""!=b&&h.go("search",{suchwort:b,key:r})};b.showSearch=function(){0<c.AnzahlMobilIcon&&(b.showSearchInput=!b.showSearchInput)};b.logout=function(){f.post("session/logout").then(function(b){l.path="/";k.location.reload()})};b.removeArtikelFromWarenkorb=function(b,d){g.removeArtikel(b,d).then(function(b){c.WK.data=b})}}]);app.controller("ContentCtrl",["$scope","$state","$stateParams","API",function(b,c,e,h){var d=c.current.action;b.titel=c.current.titel;b.currentPage=e.page?e.page:1;b.limit=d&&d.limit?d.limit:10;d&&"portal"==d.type?h.get("portal/show/"+d.value).then(function(c){b.data=c}):d&&"formular"==d.type?h.get("formular/data/"+e.id,{q:"all"}).then(function(c){b.data=c}):d&&d.bereich?(b.bereich=d.bereich,b.$watch("currentPage",function(d,e){d!=e&&c.go(c.current.name,{page:b.currentPage})}),e={limit:b.limit,offset:(b.currentPage-1)*b.limit,q:"all"},b.teaserLen&&(e.teaserLen=b.teaserLen),d.hk&&(e.hk=d.hk),d.uk&&(e.uk=d.uk),d.sortierung&&(e.orderBy=d.sortierung),d.reihenfolge&&(e.orderBy+=" "+d.reihenfolge),d.period&&(e.period=d.period),h.get(d.bereich+"/search",e).then(function(e){"nutzer"!=d.bereich&&"galerie"!=d.bereich&&"dokument"!=d.bereich&&d.direktDetail&&e.items&&1==e.items.length?c.go(".detail",{id:e.items[0].id},{location:"replace"}):"nutzer"!=d.bereich&&"galerie"!=d.bereich&&"dokument"!=d.bereich&&d.direktDetail&&e.items&&1==e.items.length&&1==e.items[0].items.length?c.go(".detail",{id:e.items[0].items[0].id},{location:"replace"}):"nutzer"!=d.bereich&&"galerie"!=d.bereich&&"dokument"!=d.bereich&&d.direktDetail&&e.items&&1==e.items.length&&1==e.items[0].items.length&&1==e.items[0].items[0].items.length?c.go(".detail",{id:e.items[0].items[0].items[0].id},{location:"replace"}):b.data=e})):c.current.bereich&&(d=c.current,b.bereich=d.bereich,h.get(c.current.bereich+"/data/"+e.id,{q:"all"}).then(function(c){b.data=c}))}]);app.controller("DetailCtrl",["$scope","$rootScope","$state","$stateParams","API","$q",function(b,c,e,h,d,f){"kontakt"==e.current.name?d.get("formular/data/"+(c.kunde&&c.kunde.lang&&"de"==c.kunde.lang?1:2),{q:"all"}).then(function(c){b.data=c}):e.current.action&&"formular"==e.current.action.type?d.get("formular/data/"+h.id,{q:"all"}).then(function(c){b.data=c}):h.id&&(e.current.bereich?(b.bereich=e.current.bereich,d.get(e.current.bereich+"/data/"+h.id,{q:"all"}).then(function(d){d.inhalt&&(c.og.description=String(d.inhalt).replace(/<[^>]+>/gm,""));d.imglink&&(c.og.images=[b.file+d.imglink]);d.titel&&(c.og.title=d.titel);b.data=d})):d.get(e.current.name+"/data/"+h.id,{q:"all"}).then(function(c){b.data=c}))}]);app.controller("GalerieCtrl",["$rootScope","$scope","$uibModal","ResponsiveDetection",function(b,c,e,h){c.openGalerie=function(c,f,g,h){e.open({animation:!1,size:h,templateUrl:"template/"+b.template.modalGalerie,controller:["$scope","$uibModalInstance",function(b,d){b.myWidth=window.innerWidth-70;b.myHeight=window.innerHeight-70;b.active=c;b.imgs=f;b.file=g;b.close=function(){d.close()}}]})};c.bilderprozeile=2;"lg"==h.getBreakpoint()&&(c.bilderprozeile=4);"md"==h.getBreakpoint()&&(c.bilderprozeile=3)}]);app.controller("FormularCtrl",["$scope","$rootScope","$state","API",function(b,c,e,h){b.today=function(){return new Date};b.uploadfile=[];b.setUploadFile=function(c,e){e||(e=1);b.uploadfile[e]=c};b.sendFormular=function(d,e){var f={};d.fields.forEach(function(b,c){b.value&&(f[c]=b)});h.upload("formular/send",b.uploadfile,{id:d.id,captcha:d.captcha,fields:f,betreff:e}).then(function(e){"Wrong Captcha"==e?(b.captcha(d.id),delete b.data.captcha):(b.data=null,b.msg=c.l.lng_form_send)},function(c){b.msg=c.data})};b.captcha=function(c){b.url="api/captcha?id="+c+"&"+(new Date).getTime();return b.url}}]);app.controller("LoginCtrl",["$scope","API","Modal","$uibModalStack","$state","$rootScope","$location",function(b,c,e,h,d,f,g){b.user={usern:"",passwd:""};b.welcome={};var k=[],l=new Date;k[0]=f.l.lng_monat_januar;k[1]=f.l.lng_monat_februar;k[2]=f.l.lng_monat_maerz;k[3]=f.l.lng_monat_april;k[4]=f.l.lng_monat_mai;k[5]=f.l.lng_monat_juni;k[6]=f.l.lng_monat_juli;k[7]=f.l.lng_monat_august;k[8]=f.l.lng_monat_september;k[9]=f.l.lng_monat_oktober;k[10]=f.l.lng_monat_november;k[11]=f.l.lng_monat_dezember;var k=k[l.getMonth()],n=l.getDate(),p=l.getFullYear();b.welcome.datum=n+"."+k+" "+p;l=l.getHours();if(3<=l&&10>l)b.welcome.text=f.l.lng_welcome_morgen;else if(10<=l&&18>l)b.welcome.text=f.l.lng_welcome_tag;else if(18<=l||3>l)b.welcome.text=f.l.lng_welcome_abend;b.login=function(d){b.Error=!1;c.post("session/login",d).then(function(c){!c||1!=c.shop&&1!=c.cms?b.Error=!0:(b.closeModal(),location.reload())})};b.logout=function(){c.post("session/logout").then(function(b){g.path("/");location.reload()})};b.goToRegistration=function(){b.closeModal();d.go("registrierung")};b.openPasswortModal=function(){b.status=null;e.open("template/"+f.template.modalPW,"",b)};b.Passwort_anfordern=function(d){b.status="loading";c.post("konto/forget",{eingabe:d}).then(function(c){b.status="ok"==c?"success":"error"})};b.closeModal=function(){var b=h.getTop();b&&h.dismiss(b.key)}}]);app.controller("ModalCtrl",["$scope","Modal",function(b,c){b.closeModal=function(){c.close()};b.goToWarenkorb=function(b){c.close();c.goToWarenkorb(b)}}]);app.factory("API",["$http","Upload",function(b,c){return{get:function(c,h){var d="";if(h){var e=-1==c.indexOf("?"),g;for(g in h)d+=e?"?":"&",d+=g+"="+encodeURIComponent(h[g]),e=!1;c+=d}return b.get("api/"+c).then(function(b){return b.data})},post:function(c,h){return b.post("api/"+c,h).then(function(b){return b.data})},put:function(c,h){return b.put("api/"+c,h).then(function(b){return b.data})},"delete":function(c){return b["delete"]("api/"+c).then(function(b){return b.data})},upload:function(b,h,d){return c.upload({url:"api/"+b,method:"POST",sendFieldsAs:"form",file:h,fields:d}).then(function(b){return b.data})}}}]);app.factory("ResponsiveDetection",["$window",function(b){return{getBreakpoint:function(){var c=b.innerWidth;return 768>c?"xs":992>c?"sm":1200>c?"md":"lg"}}}]);app.factory("$exceptionHandler",["$log","$injector",function(b,c){return function(e,h){b.warn(e,h);c.get("$http").post("api/webshop/log",{file:e.fileName,line:e.lineNumber,msg:e.toString(),stack:e.stack,cause:h}).then(function(){},function(){b.warn("Konnte nicht geloggt werden!")})}}]);app.directive("bindHtmlCompile",["$compile",function(b){return{restrict:"A",link:function(c,e,h){c.$watch(function(){return c.$eval(h.bindHtmlCompile)},function(d){e.html(d&&d.toString());d=c;h.bindHtmlScope&&(d=c.$eval(h.bindHtmlScope));b(e.contents())(d)})}}}]);app.directive("scrollSticky",["$window",function(b){return function(c,e,h){angular.element(b).bind("scroll",function(){var b=document.getElementById("headarea").offsetHeight;this.pageYOffset>=b+50?e.addClass("container xxx-scroll-sticky  animated slideInDown"):e.removeClass("container xxx-scroll-sticky  animated slideInDown")})}}]);app=angular.module("autocomplete",[]);app.directive("autocomplete",function(){var b=-1;return{restrict:"E",scope:{searchParam:"=ngModel",suggestions:"=data",onType:"=onType",onSelect:"=onSelect",autocompleteRequired:"="},controller:["$scope",function(b){b.selectedIndex=-1;b.initLock=!0;b.setIndex=function(c){b.selectedIndex=parseInt(c)};this.setIndex=function(c){b.setIndex(c);b.$apply()};b.getIndex=function(c){return b.selectedIndex};var c=!0;b.completing=!1;b.$watch("searchParam",function(e,d){if(d!==e&&(d||!b.initLock)&&(c&&"undefined"!==typeof b.searchParam&&null!==b.searchParam&&(b.completing=!0,b.searchFilter=b.searchParam,b.selectedIndex=-1),b.onType))b.onType(b.searchParam)});this.preSelect=function(e){c=!1;b.$apply();c=!0};b.preSelect=this.preSelect;this.preSelectOff=function(){c=!0};b.preSelectOff=this.preSelectOff;b.select=function(e){if(e&&(b.searchParam=e,b.searchFilter=e,b.onSelect))b.onSelect(e);c=!1;b.completing=!1;setTimeout(function(){c=!0},1E3);b.setIndex(-1)}}],link:function(c,e,h){setTimeout(function(){c.initLock=!1;c.$apply()},250);var d="";c.attrs={placeholder:"start typing...","class":"",id:"",inputclass:"",inputid:""};for(var f in h)d=f.replace("attr","").toLowerCase(),0===f.indexOf("attr")&&(c.attrs[d]=h[f]);h.clickActivation&&(e[0].onclick=function(b){c.searchParam||setTimeout(function(){c.completing=!0;c.$apply()},200)});document.addEventListener("keydown",function(b){switch(b.keyCode||b.which){case 27:c.select(),c.setIndex(-1),c.$apply(),b.preventDefault()}},!0);document.addEventListener("blur",function(b){setTimeout(function(){c.select();c.setIndex(-1);c.$apply()},150)},!0);e[0].addEventListener("keydown",function(d){var e=d.keyCode||d.which,f=angular.element(this).find("li").length;if(c.completing&&0!=f)switch(e){case 38:b=c.getIndex()-1;if(-1>b)b=f-1;else if(b>=f){b=-1;c.setIndex(b);c.preSelectOff();break}c.setIndex(b);-1!==b&&c.preSelect(angular.element(angular.element(this).find("li")[b]).text());c.$apply();break;case 40:b=c.getIndex()+1;if(-1>b)b=f-1;else if(b>=f){b=-1;c.setIndex(b);c.preSelectOff();c.$apply();break}c.setIndex(b);-1!==b&&c.preSelect(angular.element(angular.element(this).find("li")[b]).text());break;case 39:case 13:case 9:b=c.getIndex();-1!==b?(c.select(angular.element(angular.element(this).find("li")[b]).text()),13==e&&d.preventDefault()):13==e&&c.select();c.setIndex(-1);c.$apply();break;case 27:c.select(),c.setIndex(-1),c.$apply(),d.preventDefault()}})},template:'\r\n        <div class="autocomplete {{ attrs.class }}" id="{{ attrs.id }}">\r\n          <input\r\n            type="text"\r\n            ng-model="searchParam"\r\n            placeholder="{{ attrs.placeholder }}"\r\n            class="{{ attrs.inputclass }}"\r\n            id="{{ attrs.inputid }}"\r\n            autofocus\r\n            ng-required="{{ autocompleteRequired }}" />\r\n          <ul ng-show="completing && suggestions.length > 0">\r\n            <li\r\n              suggestion\r\n              ng-repeat="suggestion in suggestions track by $index"\r\n              index="{{ $index }}"\r\n              val="{{ suggestion }}"\r\n              ng-class="{ active: ($index === selectedIndex) }"\r\n              ng-click="select(suggestion)"\r\n              ng-bind="suggestion"></li>\r\n          </ul>\r\n        </div>'}});app.directive("suggestion",function(){return{restrict:"A",require:"^autocomplete",link:function(b,c,e,h){c.bind("mouseenter",function(){h.preSelect(e.val);h.setIndex(e.index)});c.bind("mouseleave",function(){h.preSelectOff()})}}});function XMLWriter(b,c){b&&(this.encoding=b);c&&(this.version=c)}(function(){function b(c){for(var e=c.c.length;e--;)"object"==typeof c.c[e]&&b(c.c[e]);c.n=c.a=c.c=null}function c(b,h,d,f){var e=h+"<"+b.n,k=b.c.length,l,n=0;for(l in b.a)e+=" "+l+'="'+b.a[l]+'"';f.push(e+(k?">":" />"));if(k){do if(e=b.c[n++],"string"==typeof e){if(1==k)return f.push(f.pop()+e+"</"+b.n+">");f.push(h+d+e)}else"object"==typeof e&&c(e,h+d,d,f);while(n<k);f.push(h+"</"+b.n+">")}}XMLWriter.prototype={encoding:"ISO-8859-1",version:"1.0",formatting:"indented",indentChar:"\t",indentation:1,newLine:"\n",writeStartDocument:function(b){this.close();this.stack=[];this.standalone=b},writeEndDocument:function(){this.active=this.root;this.stack=[]},writeDocType:function(b){this.doctype=b},writeStartElement:function(b,c){c&&(b=c+":"+b);var d=this.active,e={n:b,a:{},c:[]};d?(d.c.push(e),this.stack.push(d)):this.root=e;this.active=e},writeEndElement:function(){this.active=this.stack.pop()||this.root},writeAttributeString:function(b,c){this.active&&(this.active.a[b]=c)},writeString:function(b){this.active&&this.active.c.push(b)},writeElementString:function(b,c,d){this.writeStartElement(b,d);this.writeString(c);this.writeEndElement()},writeCDATA:function(b){this.writeString("<![CDATA["+b+"]]\x3e")},writeComment:function(b){this.writeString("\x3c!-- "+b+" --\x3e")},flush:function(){var b="",h=this.indentation,d="indented"==this.formatting.toLowerCase(),f='<?xml version="'+this.version+'" encoding="'+this.encoding+'"';this.stack&&this.stack[0]&&this.writeEndDocument();void 0!==this.standalone&&(f+=' standalone="'+!!this.standalone+'"');f=[f+" ?>"];this.doctype&&this.root&&f.push("<!DOCTYPE "+this.root.n+" "+this.doctype+">");if(d)for(;h--;)b+=this.indentChar;this.root&&c(this.root,"",b,f);return f.join(d?this.newLine:"")},close:function(){this.root&&b(this.root);this.active=this.root=this.stack=null},getDocument:window.ActiveXObject?function(){var b=new ActiveXObject("Microsoft.XMLDOM");b.async=!1;b.loadXML(this.flush());return b}:function(){return(new DOMParser).parseFromString(this.flush(),"text/xml")}}})();var darstellung="liste",limitTo=1;app.controller("KontoCtrl",["$rootScope","$scope","Warenkorb","$state","API","$timeout","$stateParams","$location",function(b,c,e,h,d,f,g,k){c.ret={};c.loading=!1;c.ret.success=!1;c.update_data=!1;c.bereich=g.bereich?g.bereich:"daten";c.p1=g.p1?g.p1:"rechnungsadresse";c.data={};c.belege={};c.belege.seite=g.seite?parseInt(g.seite):1;c.belege.status=g.status?g.status:"";c.belege.suche=g.suche?g.suche:"";c.belege.belegtyp=g.belegtyp?g.belegtyp:"";c.belege.sortby=g.sortby?g.sortby:"";c.belege.sorton=g.sorton?g.sorton:"ASC";c.Belege=[];var l;"daten"==c.bereich?d.get("konto/kundenfelder").then(function(b){c.Kundenfelder=b.felder;c.Laenderauswahl=b.laenderliste;"rechnungsadresse"!=c.p1&&"lieferadresse"!=c.p1&&"benutzer"!=c.p1||"konto"!=h.current.name||c.get(c.p1)}):"bestellung"==c.bereich&&(c.loading=!0,d.get("konto/belege",c.belege).then(function(b){c.Belege=b;c.loading=!1}));c.$watchCollection("belege",function(b,e){b!=e&&(l&&f.cancel(l),l=f(function(){c.loading=!0;h.go(".",b,{notify:!1});d.get("konto/belege",b).then(function(b){c.Belege=b;c.loading=!1})},500))});c.get=function(b){c.ret.success=!1;c.update_data=!1;c.data={};d.get("konto/"+b).then(function(d){"rechnungsadresse"==b?c.data=d:c.daten=d})};c.update=function(e,f){c.ret.success=!1;c.ok=!0;c.ret.error="";"email"==e&&(c.kunde.email!=f.alt?(c.ok=!1,c.ret.error=b.l.lng_konto_email_alt_falsch):f.neu!=f.check&&(c.ok=!1,c.ret.error=b.l.lng_konto_email_neu_check_falsch));"passwort"==e&&f.neu!=f.check&&(c.ok=!1,c.ret.error=b.l.lng_konto_pw_neu_check_falsch);c.ok&&d.put("konto/"+e,f).then(function(d){1==d?(c.ret.success=!0,c.ret.error="","benutzer"==e&&(c.daten.splice(c.index,1),c.daten.push(angular.copy(f)))):(c.ret.success=!1,"email"==e?c.ret.error=b.l.lng_konto_email_bereits_vorhanden:"passwort"==e?c.ret.error=b.l.lng_konto_pw_alt_falsch:"rechnungsadresse"==e?c.ret.error=b.l.lng_konto_email_bereits_vorhanden:"benutzer"==e&&(c.ret.error=b.l.lng_konto_email_bereits_vorhanden))})};c.setUpload=function(b){b?(c.uploaddocname=b.name,c.uploaddoc=b):(c.uploaddocname=null,c.uploaddoc=null)};c.create=function(e,f){c.ret.success=!1;"registrierung"==e&&(c.loading=!0);"registrierung"==e?d.upload("konto/"+e,c.uploaddoc,f).then(function(d){c.loading=!1;d.Error?c.ret.error=d.Error:(c.daten=d,c.ret.success=!0,c.ret.error="",c.data={},"registrierung"==e&&(b.row.reg_double_opt_in?(alert(b.l.lng_registration_double_opt_in_success),k.path("/")):(alert(b.l.lng_registration_success),location.reload())))}):d.post("konto/"+e,f).then(function(d){c.loading=!1;d.Error?c.ret.error=d.Error:(c.daten=d,c.ret.success=!0,c.ret.error="",c.data={},"registrierung"==e&&(b.row.reg_double_opt_in?(alert(b.l.lng_registration_double_opt_in_success),k.path("/")):(alert(b.l.lng_registration_success),location.reload())))})};c["delete"]=function(b,e){c.ret.success=!1;if("lieferadresse"==b)var f=e.Adresse;else"benutzer"==b&&(f=e.Nummer);d["delete"]("konto/"+b+"/"+f).then(function(b){c.daten=b;c.data={};c.update_data=!1})};c.edit=function(b,d){c.ret.success=!1;c.update_data=!0;d&&(c.index=d);c.data=angular.copy(b)};c.clear=function(){c.ret.success=!1;c.update_data=!1;c.data={}};c.getBelegartikel=function(b){c.Belegartikel={};d.get("konto/belege/"+b).then(function(b){c.Belegartikel=b})};c.pushToWarenkorb=function(c){e.addArtikel(c,"b").then(function(c){b.WK.data=c})}}]);app.controller("BestellvorschlagCtrl",["$scope","Konto","Warenkorb","$rootScope",function(b,c,e,h){b.state.preisliste=!0;c.getBestellvorschlag().then(function(c){b.Bestellvorschlag=c});b.pushToWarenkorb=function(b){e.addArtikel(b,"b").then(function(b){h.WK.data=b})}}]);app.controller("WarenkorbCtrl",["$scope","$sce","$state","$rootScope","API","$stateParams",function(b,c,e,h,d,f){var g,k=h.kunde.eingeloggt;"angebot"==e.current.name?g="a":"warenkorb"==e.current.name?g="b":"lagerbuchung"==e.current.name&&(g="l");e=f.p1?f.p1:1;1==e?b.warenkorb_url=c.trustAsResourceUrl("3xios/beleg1.php?belegtyp="+g):2==e&&(b.warenkorb_url=c.trustAsResourceUrl("3xios/beleg2.php?belegtyp="+g));resizeIframe=function(b){d.get("session/status").then(function(b){!k&&b.kunde.eingeloggt&&window.top.location.reload();h.WK.data=b.WK});window.scrollTo(0,0);b.style.height=b.contentWindow.document.body.scrollHeight+"px"}}]);app.controller("MerkzettelCtrl",["$scope","$rootScope","$state","$stateParams","Merkzettel","Warenkorb",function(b,c,e,h,d,f){b.Merkzettel={};b.ArtikelBereitsInMerkzettel=[];var g="";h.artnr?g=h.artnr:b.ArtNrMerkzettel&&(g=b.ArtNrMerkzettel);d.getListe().then(function(c){b.Merkzettel.Liste=c.Merkzettel;b.Merkzettel.Preisbemerkung=c.Preisbemerkung;b.ArtikelBereitsInMerkzettel=d.ArtikelInMerkzettel(b.Merkzettel.Liste,g)});b.pushToWarenkorb=function(b){f.addArtikel(b,"b").then(function(b){c.WK.data=b})};b.deleteMerkzettel=function(c){confirm("Merkzettel wirklich l\u00f6schen?")&&d["delete"](c).then(function(c){b.Merkzettel.Liste=c.Merkzettel;b.ArtikelBereitsInMerkzettel=d.ArtikelInMerkzettel(b.Merkzettel.Liste,g)})};b.createMerkzettel=function(c){b.Merkzettel.Titel="";d.create(c).then(function(c){b.Merkzettel.Liste=c.Merkzettel;b.ArtikelBereitsInMerkzettel=d.ArtikelInMerkzettel(b.Merkzettel.Liste,g)})};b.pushArtikelToMerkzettel=function(c){d.addArtikel(g,c).then(function(c){b.Merkzettel.Liste=c.Merkzettel;b.ArtikelBereitsInMerkzettel=d.ArtikelInMerkzettel(b.Merkzettel.Liste,g)})};b.removeArtikelFromMerkzettel=function(c,e){d.removeArtikel(c,e).then(function(c){b.Merkzettel.Liste=c.Merkzettel;b.ArtikelBereitsInMerkzettel=d.ArtikelInMerkzettel(b.Merkzettel.Liste,g)})}}]);app.controller("ArtikeldetailCtrl",["$scope","$rootScope","$stateParams","Artikel","$state","Warenkorb","Modal","$location",function(b,c,e,h,d,f,g,k){b.zubehoer_mitbestellen=[];b.varModel1="";b.varModel2="";b.aktuellerIndex=0;b.showVariantenauswahl1=!1;b.showVariantenauswahl2=!1;c.titel=e.id;h.getDetails(e.artnr).then(function(d){c.og.images=d.Artikelbild;d.Langtext&&(c.og.description=d.Langtext.HTMLText?String(d.Langtext.HTMLText).replace(/<[^>]+>/gm,""):d.Langtext.Text);b.Artikel=d;b.Artikel.Menge=1;b.Artikel.Mengenumrechnung&&(b.Artikel.MengUm={open:!1},b.changeMengeneinheit(b.Artikel.Mengenumrechnung[0]));if(b.Artikel.Varianten){var f=Object.keys(b.Artikel.Varianten[0]);b.Variante1=[];b.Variante2=[];angular.forEach(b.Artikel.Varianten,function(c){c[f[1]]&&(e.artnr==c.Artikelnummer&&(b.varModel1=c[f[1]]),b.showVariantenauswahl1=!0,-1==b.Variante1.indexOf(c[f[1]])&&b.Variante1.push(c[f[1]]));c[f[2]]&&(e.artnr==c.Artikelnummer&&(b.varModel2=c[f[2]]),b.showVariantenauswahl2=!0,-1==b.Variante2.indexOf(c[f[2]])&&b.Variante2.push(c[f[2]]))})}if(b.Artikel.Liste)for(a=0;a<b.Artikel.Liste.length;a++)if(b.Artikel.Liste[a].Artikelnummer==e.artnr){b.aktuellerIndex=a;break}});b.switchToArtikel=function(b){d.go(".",{id:b.Bezeichnung,artnr:b.Artikelnummer})};b.pushToWarenkorb=function(d,e){var g=[];b.Artikel.Zubehoer&&angular.forEach(b.Artikel.Zubehoer,function(c){void 0!=b.zubehoer_mitbestellen[c.Artikelnummer]&&0<b.zubehoer_mitbestellen[c.Artikelnummer]&&g.push({Artikelnummer:c.Artikelnummer,Menge:b.zubehoer_mitbestellen[c.Artikelnummer]})});f.addArtikel(d,e,g).then(function(b){c.WK.data=b})};b.openMerkzettel=function(){b.kunde.eingeloggt?g.open("template/"+c.template.modalMerkzettel,"MerkzettelCtrl",b):g.open("template/"+c.template.modalLogin,"LoginCtrl",b)};b.changeArtikel=function(c,f){var g;b.showVariantenauswahl1&&b.showVariantenauswahl2?(b.varModel1=c,b.varModel2=f,b.varModel1&&!b.varModel2?(b.Variante2=[],angular.forEach(b.Artikel.Varianten,function(c){c[Object.keys(c)[1]]==b.varModel1&&-1==b.Variante2.indexOf(c[Object.keys(c)[2]])&&b.Variante2.push(c[Object.keys(c)[2]])})):!b.varModel1&&b.varModel2?(b.Variante1=[],angular.forEach(b.Artikel.Varianten,function(c){c[Object.keys(c)[2]]==b.varModel2&&-1==b.Variante1.indexOf(c[Object.keys(c)[1]])&&b.Variante1.push(c[Object.keys(c)[1]])})):b.varModel1&&b.varModel2?b.Artikel.Varianten.some(function(c){if(c[Object.keys(c)[1]]==b.varModel1&&c[Object.keys(c)[2]]==b.varModel2)return g=c.Artikelnummer,!0}):g=b.Artikel.Variantenartikel):b.showVariantenauswahl1&&!b.showVariantenauswahl2?(b.varModel1=c,b.varModel1||(g=b.Artikel.Variantenartikel),b.Artikel.Varianten.some(function(c){if(c[Object.keys(c)[1]]==b.varModel1)return g=c.Artikelnummer,!0})):!b.showVariantenauswahl1&&b.showVariantenauswahl2&&(b.varModel2=f,b.varModel2||(g=b.Artikel.Variantenartikel),b.Artikel.Varianten.some(function(c){if(c[Object.keys(c)[2]]==b.varModel2)return g=c.Artikelnummer,!0}));g&&d.go(".",{id:e.id,artnr:g})};b.changeMengeneinheit=function(c){b.Artikel.MengUm.select=c;c.Preis.Brutto&&(b.Artikel.Artikelpreis.Brutto=c.Basis_Faktor*c.Preis.Brutto);c.Preis.Netto&&(b.Artikel.Artikelpreis.Netto=c.Basis_Faktor*c.Preis.Netto);c.Preis.Listenpreis&&(c.Preis.Listenpreis.Brutto&&(b.Artikel.Artikelpreis.Listenpreis.Brutto=c.Basis_Faktor*c.Preis.Listenpreis.Brutto),c.Preis.Listenpreis.Netto&&(b.Artikel.Artikelpreis.Listenpreis.Netto=c.Basis_Faktor*c.Preis.Listenpreis.Netto));b.Artikel.MengUm.open=!1}}]);app.controller("ArtikellistenCtrl",["$rootScope","$scope","$stateParams","$state","Artikel","Warenkorb","ResponsiveDetection","Modal","API",function(b,c,e,h,d,f,g,k,l){var n=g.getBreakpoint();c.state.preisliste=!0;c.changeMengeneinheit=function(b,c){c.MengUm.select=b;b.Preis.Brutto&&(c.Artikelpreis.Brutto=b.Basis_Faktor*b.Preis.Brutto);b.Preis.Netto&&(c.Artikelpreis.Netto=b.Basis_Faktor*b.Preis.Netto);b.Preis.Listenpreis&&(b.Preis.Listenpreis.Brutto&&(c.Artikelpreis.Listenpreis.Brutto=b.Basis_Faktor*b.Preis.Listenpreis.Brutto),b.Preis.Listenpreis.Netto&&(c.Artikelpreis.Listenpreis.Netto=b.Basis_Faktor*b.Preis.Listenpreis.Netto));c.MengUm.open=!1};c.list={};c.list.page=e.page?parseInt(e.page):1;c.list.filter=e.filter?e.filter:"";c.list.sortBy=e.sortBy?b.settings.sortBy=e.sortBy:b.settings.sortBy?b.settings.sortBy:b.settings.sortBy="Artikelnummer";c.list.sortOn=e.sortOn?b.settings.sortOn=e.sortOn:b.settings.sortOn?b.settings.sortOn:b.settings.sortOn="ASC";c.list.limitTo=e.limitTo?b.settings.limitTo=parseInt(e.limitTo):b.settings.limitTo?parseInt(b.settings.limitTo):1<limitTo?b.settings.limitTo=parseInt(limitTo):b.settings.maxanzahl_listenansicht?b.settings.limitTo=parseInt(b.settings.maxanzahl_listenansicht):10;c.list.darstellung=e.darstellung?b.settings.darstellung=e.darstellung:b.settings.darstellung?b.settings.darstellung:b.settings.darstellung=darstellung;e.suchwort&&(c.list.suchwort=e.suchwort);c.list.baum=!1;c.$watchCollection("list",function(b,c){b!=c&&("xs"!=n&&"sm"!=n||document.activeElement.blur(),h.go(h.current.name,b))});h.current.prev?h.current.prev[0].action.baum&&(c.list.baum=!0):h.current.action.baum&&(c.list.baum=!0);g="";-1==h.current.name.indexOf(".search")?h.current.action.value&&!c.list.suchwort&&(g=h.current.action.value):c.list.suchwort=e.suchwort;d.getUebersicht(g,c.list).then(function(d){c.data=d;d.Liste&&(b.Artikelliste=d.Liste);(b.row.liste_mit_varianten||b.row.artikelspezifische_mengeneinheiten_umrechnen)&&angular.forEach(c.data.Values,function(b,d){b.Mengenumrechnung&&(b.MengUm={open:!1},c.changeMengeneinheit(b.Mengenumrechnung[0],b));if(b.Varianten){var e=Object.keys(b.Varianten[0]);c.data.Values[d].Variante1=[];c.data.Values[d].Variante2=[];angular.forEach(b.Varianten,function(b){b[e[1]]&&(c.data.Values[d].showVariantenauswahl1=!0,-1==c.data.Values[d].Variante1.indexOf(b[e[1]])&&c.data.Values[d].Variante1.push(b[e[1]]));b[e[2]]&&(c.data.Values[d].showVariantenauswahl2=!0,-1==c.data.Values[d].Variante2.indexOf(b[e[2]])&&c.data.Values[d].Variante2.push(b[e[2]]))})}})});c.pushToWarenkorb=function(c,d){f.addArtikel(c,d||"b",null).then(function(c){b.WK.data=c})};c.openMerkzettel=function(d){c.ArtNrMerkzettel=d;c.kunde.eingeloggt?k.open("template/"+b.template.modalMerkzettel,"MerkzettelCtrl",c):k.open("template/"+b.template.modalLogin,"LoginCtrl",c)};c.changeArtikel=function(b){var d=b.Variantenartikel?b.Variantenartikel:b.Artikelnummer;var e=!1;b.showVariantenauswahl1&&b.showVariantenauswahl2?b.varModel1&&!b.varModel2?(b.Variante2=[],angular.forEach(b.Varianten,function(c){c[Object.keys(c)[1]]==b.varModel1&&-1==b.Variante2.indexOf(c[Object.keys(c)[2]])&&b.Variante2.push(c[Object.keys(c)[2]])})):!b.varModel1&&b.varModel2?(b.Variante1=[],angular.forEach(b.Varianten,function(c){c[Object.keys(c)[2]]==b.varModel2&&-1==b.Variante1.indexOf(c[Object.keys(c)[1]])&&b.Variante1.push(c[Object.keys(c)[1]])})):(b.varModel1&&b.varModel2&&b.Varianten.some(function(c){if(c[Object.keys(c)[1]]==b.varModel1&&c[Object.keys(c)[2]]==b.varModel2)return d=c.Artikelnummer,!0}),e=!0):b.showVariantenauswahl1&&!b.showVariantenauswahl2?(b.Varianten.some(function(c){if(c[Object.keys(c)[1]]==b.varModel1)return d=c.Artikelnummer,!0}),e=!0):!c.showVariantenauswahl1&&c.showVariantenauswahl2&&(b.Varianten.some(function(c){if(c[Object.keys(c)[2]]==b.varModel2)return d=c.Artikelnummer,!0}),e=!0);e&&l.post("article/variante",{Artikelnummer:d}).then(function(d){keys=Object.keys(d);for(i=0;i<keys.length;i++)b[keys[i]]=d[keys[i]],b.Mengenumrechnung&&(b.MengUm={open:!1},c.changeMengeneinheit(b.Mengenumrechnung[0],b))})}}]);app.controller("ArtikelgruppenCtrl",["$scope","$state",function(b,c){c.current.nodes&&(b.Artikelgruppen=c.current.nodes)}]);app.controller("PreislistenCtrl",["$scope","API","$state",function(b,c,e){var h="";b.name="";var d={limitTo:100};e.params&&e.params.suchwort?(d.suchwort=e.params.suchwort,b.name="Preisliste_"+e.params.suchwort):e.current.action&&e.current.action.value?(h=e.current.action.value,b.name="Preisliste_"+e.current.action.value):"bestellvorschlag"==e.current.name&&(h=e.current.name,b.name="Preisliste_Bestellvorschlag");c.get("preisliste/"+h,d).then(function(c){b.Preisliste=c.Values});b.createXML=function(){var c=new XMLWriter;c.writeStartDocument();c.writeStartElement("ORDER");c.writeStartElement("ORDER_HEADER");c.writeStartElement("ORDER_INFO");c.writeStartElement("SUPPLIER_ID");c.writeString(b.kunde.kundennummer);c.writeEndElement();c.writeStartElement("ORDER_DATE");c.writeString(Date());c.writeEndElement();c.writeEndElement();c.writeEndElement();c.writeStartElement("ORDER_ITEM_LIST");angular.forEach(b.Preisliste,function(b){c.writeStartElement("ORDER_ITEM");c.writeStartElement("ARTICLE_ID");c.writeStartElement("SUPPLIER_AID");c.writeString(b.Artikelnummer);c.writeEndElement();c.writeStartElement("DESCRIPTION_SHORT");c.writeString(b.Bezeichnung);c.writeEndElement();c.writeStartElement("QUANTITY");c.writeString(b.Preiseinheit+"");c.writeEndElement();c.writeEndElement();c.writeStartElement("ARTICLE_ORDER_DETAILS");c.writeStartElement("ORDER_UNIT");c.writeString(b.Mengeneinheit);c.writeEndElement();c.writeEndElement();c.writeStartElement("ARTICLE_PRICE_DETAILS");c.writeStartElement("ARTICLE_PRICE_DETAILS");c.writeStartElement("PRICE_AMOUNT");b.Artikelpreis.Netto&&!b.Artikelpreis.Brutto?c.writeString(b.Artikelpreis.Netto+""):b.Artikelpreis.Brutto&&!b.Artikelpreis.Netto?c.writeString(b.Artikelpreis.Brutto+""):b.Artikelpreis.Netto&&b.Artikelpreis.Brutto&&c.writeString(b.Artikelpreis.Netto+"  ("+b.Artikelpreis.Brutto+")");c.writeEndElement();c.writeStartElement("PRICE_CURRENCY");c.writeString("EUR");c.writeEndElement();c.writeEndElement();c.writeEndElement();c.writeEndElement()});c.writeEndElement();c.writeEndElement();c.writeEndDocument();b.titel=b.name+".xml";b.url=(window.URL||window.webkitURL).createObjectURL(new Blob([c.flush()]))};b.createCSV=function(){var c="SUPPLIER_ID;ORDER_DATE;\r\n",c=c+(b.kunde.kundennummer+";"+Date()+"\r\n\n\n"),c=c+"SUPPLIER_AID;DESCRIPTION_SHORT;QUANTITY;ORDER_UNIT;PRICE_AMOUNT;PRICE_CURRENCY;\r\n";angular.forEach(b.Preisliste,function(b){c+=b.Artikelnummer+";";c+=b.Bezeichnung+";";c+=b.Preiseinheit+";";c+=b.Mengeneinheit+";";c=b.Artikelpreis.Netto&&!b.Artikelpreis.Brutto?c+(b.Artikelpreis.Netto+""):b.Artikelpreis.Brutto&&!b.Artikelpreis.Netto?c+(b.Artikelpreis.Brutto+""):b.Artikelpreis.Netto&&b.Artikelpreis.Brutto?c+(b.Artikelpreis.Netto+"  ("+b.Artikelpreis.Brutto+");"):c+";";c+="EUR;\r\n"});b.titel=b.name+".csv";b.url=(window.URL||window.webkitURL).createObjectURL(new Blob([c]))}}]);app.factory("Artikel",["$http",function(b){return{getUebersicht:function(c,e){var h="";if(e){var d=-1,f;for(f in e)h+=d?"?":"&",h+=f+"="+encodeURIComponent(e[f]),d=!1}return b.get("api/article/list/"+c+h).then(function(b){return b.data})},getDetails:function(c){return b.get("api/article/detail?artnr="+c).then(function(b){return b.data})}}}]);app.factory("Merkzettel",["$http",function(b){var c,e=[];return{getListe:function(){return b.get("api/merkzettel/get").then(function(b){return c="null"!=b.data?b.data:""})},create:function(e){return b.post("api/merkzettel/create",{Bezeichnung:e}).then(function(b){return c="null"!=b.data?b.data:""})},"delete":function(e){return b.post("api/merkzettel/delete",{mz_id:e}).then(function(b){return c="null"!=b.data?b.data:""})},addArtikel:function(e,d){return b.post("api/merkzettel/add",{Artikelnummer:e,mz_id:d}).then(function(b){return c="null"!=b.data?b.data:""})},removeArtikel:function(e,d){return b.post("api/merkzettel/remove",{Artikelnummer:e,mz_id:d}).then(function(b){return c="null"!=b.data?b.data:""})},ArtikelInMerkzettel:function(b,c){""!=b&&angular.forEach(b,function(b){e[b.mz_id]=!1;""!=b.Values&&angular.forEach(b.Values,function(d){d.Artikelnummer==c&&(e[b.mz_id]=!0)})});return e}}}]);app.factory("Warenkorb",["$http","$rootScope","$state","Modal",function(b,c,e,h){return{removeArtikel:function(c,e){return b.post("api/warenkorb/remove",{lfdnr:c,belegtyp:e}).then(function(b){return b.data})},addArtikel:function(d,f,g){var k={};k.Artikelnummer=d.Artikelnummer;k.Menge=d.Menge;k.Bemerkung=d.Bemerkung||null;g=g||null;c.row.wk_modal_neuer_artikel&&(c.data={},c.data.Artikel=angular.copy(d),d.MengUm&&d.MengUm.select&&(c.data.Artikel.Mengeneinheit=d.MengUm.select.Mengeneinheit),c.data.Belegtyp=f,h.open("template/"+c.template.modalWarenkorb,"ModalCtrl",c));d.MengUm&&d.MengUm.select&&(k.Menge=d.MengUm.select.Basis_Faktor*d.Menge);return b.post("api/warenkorb/add",{Artikel:k,Zubehoer:g,Belegtyp:f}).then(function(b){c.row.wk_klick_wk_landen&&("a"==f?e.go("angebot"):e.go("warenkorb"));return b.data})}}}]);app.factory("Konto",["$http",function(b){return{getBestellvorschlag:function(){return b.get("api/bestellvorschlag").then(function(b){return b.data})}}}]);app.factory("Modal",["$uibModal","$uibModalStack","$state",function(b,c,e){return{close:function(){var b=c.getTop();b&&c.dismiss(b.key)},open:function(c,d,e,g){b.open({animation:!1,templateUrl:c,controller:d,scope:e,size:g})},goToWarenkorb:function(b){"b"!=(b||"b")?e.go("angebot"):e.go("warenkorb")}}}]);